-- This is wrapped by a transaction in schema.js

CREATE SCHEMA IF NOT EXISTS log_aggregate_db;

-- versioning table
CREATE TABLE IF NOT EXISTS log_aggregate_db.version (
  version INTEGER
);

-- each entity is made up of multiple parts
CREATE TABLE IF NOT EXISTS log_aggregate_db.parts (
  id SERIAL PRIMARY KEY,

  "entitiesId" UUID,

  -- refers to the offset in the overall stream
  "offset" INTEGER,

  -- length of current part (mostly for clients dealing with part)
  "length" INTEGER,

  content BYTEA,

  "createdAt" TIMESTAMP WITHOUT TIME ZONE
);

-- both offset and entities_id are heavily read
CREATE INDEX log_aggregate_db_parts_entities_id
  ON log_aggregate_db.parts ("entitiesId");

CREATE INDEX log_aggregate_db_parts_offset
  ON log_aggregate_db.parts ("offset");
